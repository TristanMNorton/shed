version: "2"

services:
    apache:
        image: "shedhost/apache"
        restart: always

        environment:
            APACHE_LOG_LEVEL: "${logging}"
            APACHE_DEFAULT_DOCROOT: "${docroot}"

        volumes:
            - "./:/var/shed"
            - "./config/apache/default.conf:/etc/apache2/sites-enabled/000-default.conf"
            - "./config/apache/php.ini:/usr/local/etc/php/php.ini"
            - "${sites}:/var/www"

        ports:
            - "${port}:80"

        links:
            - postgres
            - mysql
            - memcached

    memcached:
        image: "memcached:1.4"
        restart: always

    postgres:
        image: "postgres:9.6"
        restart: always

        environment:
            PGDATA: "/var/lib/postgresql/data/pgdata"

        volumes:
            - "${HOME}/.shed/data/postgres:/var/lib/postgresql/data/pgdata"

    mysql:
        image: "mysql:8.0"
        restart: always

        environment:
            MYSQL_ALLOW_EMPTY_PASSWORD: "yes"

        volumes:
            - "${HOME}/.shed/data/mysql:/var/lib/mysql"
